<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive School Building</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }



        .svg-container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            background: #fafafa;
        }

        .svg-container object {
            display: block;
            width: 100%;
            height: auto;
        }
    </style>
</head>

<body>
    <div class="container">

        <div class="svg-container">
            <object data="./Content/imgs/K-12Map-with-Pins.svg" type="image/svg+xml" id="svg-object">
            </object>
        </div>
    </div>

    <script>
        const svgObject = document.getElementById('svg-object');

        svgObject.addEventListener('load', function () {
            const svgDoc = svgObject.contentDocument;
            if (!svgDoc) return;

            // Map of section IDs to section data
            const sections = {
                'classrooms': { title: 'Classrooms', desc: 'Learning spaces' },
                'science-lab': { title: 'Science Lab', desc: 'Laboratory facilities' },
                'locker-room': { title: 'Locker Room', desc: 'Athletic facilities' },
                'gym': { title: 'Gymnasium', desc: 'Sports activities' },
                'lobby': { title: 'Lobby', desc: 'Main entrance' },
                'admin-offices': { title: 'Admin Offices', desc: 'Administrative offices' },
                'cafeteria': { title: 'Cafeteria', desc: 'Dining area' },
                'kitchen': { title: 'Kitchen', desc: 'Food preparation' }
            };

            // Map text IDs to section keys
            const textToSectionMap = {
                'Gym': 'gym',
                'Lobby': 'lobby',
                'Admin-Offices': 'admin-offices',
                'Locker-Room': 'locker-room',
                'Science-Lab': 'science-lab',
                'Classrooms': 'classrooms',
                'Kitchen': 'kitchen',
                'Cafeteria': 'cafeteria'
            };

            // Find all marker groups and text elements
            const markerGroups = [
                svgDoc.getElementById('admin-offices-target'),
                svgDoc.getElementById('Kitchen-marker'),
                svgDoc.getElementById('cafeteria-marker'),
                // Group-18 elements that contain markers
                ...Array.from(svgDoc.querySelectorAll('g[id="Group-18"]'))
            ].filter(Boolean);

            // Find text elements that identify sections
            const textElements = Array.from(svgDoc.querySelectorAll('text[id]')).filter(
                text => Object.keys(textToSectionMap).includes(text.id)
            );

            // Make marker groups clickable
            markerGroups.forEach(marker => {
                // Find the associated text element within the marker group
                const textEl = marker.querySelector('text[id]');
                if (textEl && textEl.id) {
                    const sectionKey = textToSectionMap[textEl.id];
                    if (sectionKey) {
                        marker.style.cursor = 'pointer';
                        marker.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const rect = marker.getBoundingClientRect();
                            showPopover(sectionKey, rect.left + rect.width / 2, rect.top);
                        });
                    }
                }
            });

            // Also make text elements clickable (in case they're outside groups)
            textElements.forEach(textEl => {
                const sectionKey = textToSectionMap[textEl.id];
                if (sectionKey) {
                    // Find the parent group if it exists
                    let parentGroup = textEl.closest('g[id*="marker"], g[id*="target"], g[id="Group-18"]');
                    if (parentGroup) {
                        parentGroup.style.cursor = 'pointer';
                        if (!parentGroup.dataset.hasListener) {
                            parentGroup.addEventListener('click', (e) => {
                                e.stopPropagation();
                                const rect = parentGroup.getBoundingClientRect();
                                showPopover(sectionKey, rect.left + rect.width / 2, rect.top);
                            });
                            parentGroup.dataset.hasListener = 'true';
                        }
                    } else {
                        // If no parent group, make the text itself clickable
                        textEl.style.cursor = 'pointer';
                        textEl.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const rect = textEl.getBoundingClientRect();
                            showPopover(sectionKey, rect.left + rect.width / 2, rect.top);
                        });
                    }
                }
            });

            function closePopover() {
                const popover = document.getElementById('section-popover');
                if (popover) {
                    popover.style.display = 'none';
                }
            }

            function showPopover(sectionId, x, y) {
                const data = sections[sectionId] || { title: sectionId, desc: 'Section area' };

                let popover = document.getElementById('section-popover');
                if (!popover) {
                    popover = document.createElement('div');
                    popover.id = 'section-popover';
                    popover.style.cssText = `
            position: fixed;
            background: white;
            padding: 12px 16px;
            padding-right: 36px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            pointer-events: auto;
          `;
                    document.body.appendChild(popover);
                }

                popover.innerHTML = `
          <button onclick="closePopover()" style="
            position: absolute;
            top: 8px;
            right: 8px;
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: #666;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            line-height: 1;
          " title="Close">Ã—</button>
          <div style="font-weight: bold; font-size: 14px; margin-bottom: 4px;">${data.title}</div>
          <div style="font-size: 12px; color: #666;">${data.desc}</div>
        `;

                popover.style.left = `${x}px`;
                popover.style.top = `${y - 10}px`;
                popover.style.transform = 'translate(-50%, -100%)';
                popover.style.display = 'block';
            }

            // Make closePopover available globally
            window.closePopover = closePopover;
        });
    </script>
</body>

</html>